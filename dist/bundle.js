(()=>{"use strict";var t={752:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function o(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,o)}c((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.state_trail=e.tip_trail=e.arm_tip_target=e.loss_highres_coord=e.loss_heatmap_coord=e.arm_coord=void 0;var s=n(103),i=n(489),o=n(685),c=n(310),u=n(527),_=n(461),l=n(185),h=n(395),d=document.getElementById("arm_canvas"),p=document.getElementById("loss_heatmap_canvas"),m=document.getElementById("loss_highres_canvas");d.width=300,d.height=300,p.width=300,p.height=300,m.width=300,m.height=300,e.arm_coord=new s.coordinateSystem(d,-10,10,-10,10,1),e.loss_heatmap_coord=new s.coordinateSystem(p,0,2*Math.PI,0,2*Math.PI,.3),e.loss_highres_coord=new s.coordinateSystem(m,0,2*Math.PI,0,2*Math.PI,1),e.loss_highres_coord.set_as_overlay_on(e.loss_heatmap_coord),(0,o.makeArm)(2),e.arm_tip_target=new _.v2(10*Math.random()-5,10*Math.random()-5),d.addEventListener("mousedown",(function(t){e.arm_tip_target=e.arm_coord.last_mouse_pos,e.tip_trail.points=[],e.state_trail.points=[]})),d.addEventListener("mousemove",(function(t){i.input.LeftMouse&&(e.arm_tip_target=e.arm_coord.last_mouse_pos,e.tip_trail.points=[],e.state_trail.points=[])})),e.loss_heatmap_coord.canvas.addEventListener("mousedown",(function(t){o.current_arm.arm.segments[c.x_axis_index].angle=e.loss_heatmap_coord.last_mouse_pos.x,o.current_arm.arm.segments[c.y_axis_index].angle=e.loss_heatmap_coord.last_mouse_pos.y,e.tip_trail.points=[],e.state_trail.points=[]})),e.loss_heatmap_coord.canvas.addEventListener("mousemove",(function(t){i.input.LeftMouse&&(o.current_arm.arm.segments[c.x_axis_index].angle=e.loss_heatmap_coord.last_mouse_pos.x,o.current_arm.arm.segments[c.y_axis_index].angle=e.loss_heatmap_coord.last_mouse_pos.y,e.tip_trail.points=[],e.state_trail.points=[])})),e.tip_trail=new u.Trail(30,.5,2e3),e.state_trail=new u.Trail(30,.3,4),c.current_mode.rrt?(0,h.perform_rrt_mode_setup)():(0,l.perform_gradient_mode_setup)(),requestAnimationFrame((function t(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return c.current_mode.rrt?[4,(0,h.perform_rrt_mode_loop)()]:[3,2];case 1:return e.sent(),[3,3];case 2:(0,l.perform_gradient_mode_loop)(),e.label=3;case 3:return requestAnimationFrame(t),[2]}}))}))})),e.arm_coord.addAxes(2),e.loss_heatmap_coord.axis_names=["joint angle","joint angle"],e.arm_coord.axis_names=["",""],e.loss_heatmap_coord.addAxes(2)},685:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.current_loss=e.l_obj=e.get_arm_tip_pos=e.points_along_arm=e.Losses=e.perform_arm_gradient_step=e.drawArm=e.makeArm=e.copy_arm=e.current_arm=void 0;var r=n(310),a=n(461),s=e.current_arm=function(){function t(){}return t.arm={segments:[],pos:a.v2.zero()},t}();e.copy_arm=function(t){return{segments:t.segments.map((function(t){return{angle:t.angle,length:t.length}})),pos:t.pos.copy()}},e.makeArm=function(t){s.arm.segments=[];for(var e=0;e<t;e++)s.arm.segments.push({angle:2*Math.random()*Math.PI,length:10/t})},e.drawArm=function(t,e,n){for(var r=e.pos,s=0,i=e.segments;s<i.length;s++){var o=i[s],c=a.v2.fromPolar(o.angle,o.length);t.line(r,r.add(c),n),r=r.add(c)}},e.perform_arm_gradient_step=function(t,e,n,a){for(var s=0;s<t.segments.length;s++){var o=c(t,e,n);if(r.toggle_level_set.checked)for(var u=0;u<4;u++){var _=r.level_set_scale*i.get_loss(n)(t,e)+r.level_set_offset;t.segments[s].angle-=Math.cos(_)*r.level_set_scale*o[s]*a}else t.segments[s].angle-=o[s]*a}};var i=function(){function t(){}return t.get_loss=function(e){switch(e){case"L2":return t.L2;case"L2_squared":return t.L2_squared;case"L1":return t.L1;case"L1_squared":return t.L1_squared;case"Match_Y":return t.Line}},t.get_loss_gradient=function(e){switch(e){case"L2":return t.L2_gradient;case"L2_squared":return t.L2_squared_gradient;case"L1":return t.L1_gradient;case"L1_squared":return t.L1_squared_gradient;case"Match_Y":return t.Line_gradient}},t.L2=function(t,e){return a.v2.distance(o(t),e)},t.L2_gradient=function(t,e){var n=a.v2.zero(),r=t.x-e.x,s=t.y-e.y,i=Math.pow(r,2)+Math.pow(s,2);return i=Math.pow(i,-.5),n.x=i*r,n.y=i*s,n},t.L2_squared=function(t,e){return Math.pow(a.v2.distance(o(t),e),2)},t.L2_squared_gradient=function(t,e){var n=a.v2.zero();return n.x=-2*(e.x-t.x),n.y=2*(t.y-e.y),n},t.L1=function(t,e){var n=o(t);return Math.abs(n.x-e.x)+Math.abs(n.y-e.y)},t.L1_gradient=function(t,e){var n=a.v2.zero();return n.x=t.x>e.x?1:-1,n.y=t.y>e.y?1:-1,n},t.L1_squared=function(t,e){var n=o(t);return Math.pow(Math.abs(n.x-e.x)+Math.abs(n.y-e.y),2)},t.L1_squared_gradient=function(t,e){var n=a.v2.zero();return n.x=t.x>e.x?2:-2,n.y=t.y>e.y?2:-2,n.x*=Math.abs(t.x-e.x),n.y*=Math.abs(t.y-e.y),n},t.Line=function(t,e){var n=o(t);return Math.pow(n.y-e.y,2)},t.Line_gradient=function(t,e){var n=a.v2.zero();return n.y=2*(t.y-e.y),n},t}();function o(t){for(var e=t.pos,n=0,r=t.segments;n<r.length;n++){var s=r[n],i=a.v2.fromPolar(s.angle,s.length);e=e.add(i)}return e}function c(t,e,n){for(var r=o(t),s=i.get_loss_gradient(n)(r,e),c=[],u=0,_=function(t){for(var e=[],n=t.pos,r=0,s=t.segments;r<s.length;r++){var i=s[r],o=a.v2.fromPolar(i.angle,i.length);n=n.add(o);var c=-i.length*Math.sin(i.angle),u=i.length*Math.cos(i.angle),_=new a.v2(c,u);e.push(_)}return e}(t);u<_.length;u++){var l=_[u],h=0;h+=s.x*l.x,h+=s.y*l.y,c.push(h)}return c}e.Losses=i,e.points_along_arm=function(t,e){for(var n=[],r=t.pos,s=0,i=0,o=t.segments;i<o.length;i++){var c=o[i];n.push(r);for(var u=-s;u+e<c.length;){u+=e;var _=a.v2.fromPolar(c.angle,u).add(r);n.push(_)}s=c.length-u;var l=a.v2.fromPolar(c.angle,c.length);r=r.add(l)}return n.push(r),n},e.get_arm_tip_pos=o;var u=function(){this.loss="L2_squared",this.loss_func=i.get_loss("L2_squared"),this.loss_gradient_func=i.get_loss_gradient("L2_squared")};e.l_obj=u,e.current_loss=new u},185:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.perform_gradient_mode_loop=e.perform_gradient_mode_setup=void 0;var r=n(752),a=n(685),s=n(489),i=n(103),o=n(310),c=n(593),u=n(461);e.perform_gradient_mode_setup=function(){},e.perform_gradient_mode_loop=function(){r.arm_coord.clear(),r.loss_highres_coord.clear(),r.loss_heatmap_coord.heatmap(_,i.matplotlib_cmap,o.toggle_level_set.checked,o.level_set_scale,o.level_set_offset);var t=new u.v2((0,c.mod)(a.current_arm.arm.segments[o.x_axis_index].angle,2*Math.PI),(0,c.mod)(a.current_arm.arm.segments[o.y_axis_index].angle,2*Math.PI));r.loss_highres_coord.circle(t,.2,[255,0,0]),(0,s.handle_input)(),r.arm_coord.ctx.fillText("loss: ".concat(a.current_loss.loss_func(a.current_arm.arm,r.arm_tip_target).toFixed(2)),10,10),(0,a.perform_arm_gradient_step)(a.current_arm.arm,r.arm_tip_target,a.current_loss.loss,.01),r.state_trail.update(t)&&r.tip_trail.update((0,a.get_arm_tip_pos)(a.current_arm.arm)),r.tip_trail.draw(r.arm_coord,[128,50,128]),r.state_trail.draw(r.loss_highres_coord,[255,0,0]),r.arm_coord.circle(r.arm_tip_target,.5,[128,50,128]),(0,a.drawArm)(r.arm_coord,a.current_arm.arm,[0,0,0])};var _=function(t,e){var n=(0,a.copy_arm)(a.current_arm.arm);return n.segments[o.x_axis_index].angle=t,n.segments[o.y_axis_index].angle=e,a.current_loss.loss_func(n,r.arm_tip_target)}},489:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.input=e.handle_input=void 0;var r=n(752),a=n(685),s=n(310);e.handle_input=function(){e.input.ArrowRight&&(a.current_arm.arm.segments[s.x_axis_index].angle+=4*Math.PI/180),e.input.ArrowLeft&&(a.current_arm.arm.segments[s.x_axis_index].angle-=4*Math.PI/180),e.input.ArrowUp&&(a.current_arm.arm.segments[s.y_axis_index].angle+=4*Math.PI/180),e.input.ArrowDown&&(a.current_arm.arm.segments[s.y_axis_index].angle-=4*Math.PI/180),e.input.w&&(r.arm_tip_target.y+=.25,r.arm_tip_target.y=Math.min(r.arm_tip_target.y,r.arm_coord.yMax)),e.input.s&&(r.arm_tip_target.y-=.25,r.arm_tip_target.y=Math.max(r.arm_tip_target.y,r.arm_coord.yMin)),e.input.a&&(r.arm_tip_target.x-=.25,r.arm_tip_target.x=Math.max(r.arm_tip_target.x,r.arm_coord.xMin)),e.input.d&&(r.arm_tip_target.x+=.25,r.arm_tip_target.x=Math.min(r.arm_tip_target.x,r.arm_coord.xMax))},e.input={ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1,w:!1,s:!1,a:!1,d:!1,LeftMouse:!1},document.addEventListener("keydown",(function(t){t.key in e.input&&(e.input[t.key]=!0,t.preventDefault())})),document.addEventListener("keyup",(function(t){t.key in e.input&&(e.input[t.key]=!1,t.preventDefault())})),document.addEventListener("mousedown",(function(t){0==t.button&&(e.input.LeftMouse=!0)})),document.addEventListener("mouseup",(function(t){0==t.button&&(e.input.LeftMouse=!1)}))},728:function(t,e,n){var r,a=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.RectangleObstacle=e.CircleObstacle=e.Obstacle=void 0;var s=n(461),i=function(){function t(){this.bbox=null}return t.prototype.get_AABB=function(){return null!=this.bbox||(this.bbox=this.calculate_AABB()),this.bbox},t.prototype.contains=function(t){var e=this.get_AABB(),n=e[0],r=e[1];return t.x>=n.x&&t.x<=r.x&&t.y>=n.y&&t.y<=r.y&&this.query(t)},t}();e.Obstacle=i;var o=function(t){function e(e,n){var r=t.call(this)||this;return r.pos=e,r.radius=n,r}return a(e,t),e.prototype.query=function(t){return this.pos.distance(t)<=this.radius},e.prototype.calculate_AABB=function(){return[this.pos.sub(new s.v2(this.radius,this.radius)),this.pos.add(new s.v2(this.radius,this.radius))]},e.prototype.draw=function(t,e){t.circle(this.pos,this.radius,e)},e}(i);e.CircleObstacle=o;var c=function(t){function e(e,n){var r=t.call(this)||this;return r.pos=e,r.size=n,r}return a(e,t),e.prototype.query=function(t){return!0},e.prototype.calculate_AABB=function(){return[this.pos,this.pos.add(this.size)]},e.prototype.draw=function(t,e){throw new Error("Method not implemented.")},e}(i);e.RectangleObstacle=c},103:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.coordinateSystem=e.matplotlib_cmap=void 0;var r,a,s=n(461);e.matplotlib_cmap=(r=[64,25,64],a=[242,255,50],0,1,function(t){return t=Math.min(1,Math.max(0,t)),e=r,n=a,s=(t-0)/1,[Math.round((1-s)*e[0]+s*n[0]),Math.round((1-s)*e[1]+s*n[1]),Math.round((1-s)*e[2]+s*n[2])];var e,n,s});var i=function(){function t(t,e,n,r,a,i){var o=this;this.axes_canvas=null,this.axes_coords=null,this.last_mouse_pos=new s.v2(0,0),this.mouse_within_bounds=!1,this.is_overlay_on=null,this.needs_axes=!1,this.axes_resolution=1,this.axis_names=["x","y"],this.canvas=t,this.ctx=t.getContext("2d"),this.xMin=e,this.xMax=n,this.yMin=r,this.yMax=a;var c=this.canvas.width,u=this.canvas.height;this.canvas.style.width=c+"px",this.canvas.style.height=u+"px",this.canvas.width=Math.floor(c*i),this.canvas.height=Math.floor(u*i),this.scale=c/Math.floor(c*i),this.canvas.addEventListener("mousemove",(function(t){o.last_mouse_pos=o.world_to_point(new s.v2(t.clientX,t.clientY))})),this.canvas.addEventListener("mouseenter",(function(t){o.mouse_within_bounds=!0})),this.canvas.addEventListener("mouseleave",(function(t){o.mouse_within_bounds=!1})),window.addEventListener("resize",this.on_resize.bind(this))}return t.prototype.on_resize=function(){var e,n;if(this.is_overlay_on){var r=this.is_overlay_on;this.canvas.style.position="absolute",this.canvas.style.width=r.canvas.style.width,this.canvas.style.height=r.canvas.style.height,this.canvas.style.left=r.canvas.offsetLeft.toString()+"px",this.canvas.style.top=r.canvas.offsetTop.toString()+"px",this.canvas.style.pointerEvents="none",this.canvas.style.zIndex=(parseInt(r.canvas.style.zIndex)+1).toString(),this.canvas.style.imageRendering="optimize-contrast"}if(this.needs_axes){null===(e=this.axes_canvas)||void 0===e||e.remove(),this.axes_coords=null,this.axes_canvas=document.createElement("canvas"),this.axes_canvas.style.position="absolute";var a=1.4;this.axes_canvas.width=Math.round(a*this.canvas.width*this.scale*this.axes_resolution),this.axes_canvas.height=Math.round(a*this.canvas.height*this.scale*this.axes_resolution);var i=.5*(a-1)*(this.xMax-this.xMin),o=.5*(a-1)*(this.yMax-this.yMin);this.axes_coords=new t(this.axes_canvas,this.xMin-i,this.xMax+i,this.yMin-o,this.yMax+o,1),this.axes_canvas.style.width=Math.round(parseInt(this.canvas.style.width)*a).toString()+"px",this.axes_canvas.style.height=Math.round(parseInt(this.canvas.style.height)*a).toString()+"px",this.axes_canvas.style.left=(this.canvas.offsetLeft-this.canvas.width*this.scale*(a-1)*.5).toString()+"px",this.axes_canvas.style.top=(this.canvas.offsetTop-this.canvas.height*this.scale*(a-1)*.5).toString()+"px",this.axes_canvas.style.pointerEvents="none",this.axes_canvas.style.zIndex=(parseInt(this.canvas.style.zIndex)+1).toString(),this.axes_canvas.style.imageRendering="optimize-contrast",null===(n=this.canvas.parentElement)||void 0===n||n.appendChild(this.axes_canvas);var c=this.axes_canvas.getContext("2d");this.axes_coords.line(new s.v2(this.xMin,0),new s.v2(this.xMax,0),[0,0,0]),this.axes_coords.line(new s.v2(0,this.yMin),new s.v2(0,this.yMax),[0,0,0]),c.font="".concat(35,"px Times New Roman"),c.fillStyle="black",this.xMax,this.xMin,this.canvas.width;var u=new s.v2(.5,0).scale(this.xMax),_=new s.v2(this.xMax,0),l=new s.v2(this.xMin,0),h=new s.v2(0,28),d=new s.v2(0,.5).scale(this.yMax),p=new s.v2(0,this.yMax),m=new s.v2(0,this.yMin),f=new s.v2(-7,0),v=[0,0,0];this.axes_coords.draw_text(this.axis_names[0],u,0,v,"center",h),this.axes_coords.draw_text(this.xMax.toFixed(2),_,0,v,"end",h),this.axes_coords.draw_text(this.xMin.toFixed(2),l,0,v,"start",h),this.axes_coords.draw_text(this.axis_names[1].toString(),d,Math.PI/2,[255,0,0],"center",f),this.axes_coords.draw_text(this.yMax.toFixed(2).toString(),p,Math.PI/2,[255,0,0],"end",f),this.axes_coords.draw_text(this.yMin.toFixed(2).toString(),m,Math.PI/2,[255,0,0],"start",f)}},t.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.set_as_overlay_on=function(t){this.is_overlay_on=t,this.on_resize()},t.prototype.draw_text=function(t,e,n,r,a,i){void 0===a&&(a="center"),void 0===i&&(i=new s.v2(0,0));var o=this.point_to_pixel(e);this.ctx.textAlign=a,this.ctx.translate(o.x+i.x,o.y+i.y),this.ctx.rotate(-n),this.ctx.fillText(t,0,0),this.ctx.rotate(n),this.ctx.translate(-o.x-i.x,-o.y-i.y)},t.prototype.point_to_pixel=function(t){var e=(t.x-this.xMin)/(this.xMax-this.xMin)*this.ctx.canvas.width,n=(this.yMax-t.y)/(this.yMax-this.yMin)*this.ctx.canvas.height;return new s.v2(e,n)},t.prototype.line=function(t,e,n){var r=this.point_to_pixel(t),a=this.point_to_pixel(e);this.ctx.strokeStyle="rgb(".concat(n[0],", ").concat(n[1],", ").concat(n[2],")"),this.ctx.beginPath(),this.ctx.moveTo(r.x,r.y),this.ctx.lineTo(a.x,a.y),this.ctx.stroke()},t.prototype.circle=function(t,e,n){this.ctx.strokeStyle="rgb(".concat(n[0],", ").concat(n[1],", ").concat(n[2],")");var r=this.point_to_pixel(t);this.ctx.beginPath();var a=e/(this.xMax-this.xMin)*this.ctx.canvas.width;this.ctx.arc(r.x,r.y,a,0,2*Math.PI),this.ctx.stroke()},t.prototype.addAxes=function(t){this.needs_axes=!0,this.axes_resolution=t,this.on_resize()},t.prototype.world_to_point=function(t){var e=this.xMax-this.xMin,n=this.yMax-this.yMin,r=this.canvas.getBoundingClientRect(),a=(t.x-r.left)/this.canvas.width*e/this.scale+this.xMin,i=(r.bottom-t.y)/this.canvas.height*n/this.scale+this.yMin;return new s.v2(a,i)},t.prototype.heatmap=function(t,e,n,r,a){for(var s=Array(this.canvas.width*this.canvas.height*4),i=1/0,o=-1/0,c=this.xMax-this.xMin,u=this.yMax-this.yMin,_=0;_<this.canvas.height;_++)for(var l=0;l<this.canvas.width;l++){var h=t(this.xMin+(.5+l)/this.canvas.width*c,this.yMax-(.5+_)/this.canvas.height*u);s[l+_*this.canvas.width]=h,i=Math.min(i,h),o=Math.max(o,h)}var d=o-i,p=this.ctx.createImageData(this.canvas.width,this.canvas.height),m=p.data;for(_=0;_<this.canvas.height;_++)for(l=0;l<this.canvas.width;l++){var f=[0,0,0];if(n){var v=s[l+_*this.canvas.width]*r+a;f=e(.5*(Math.sin(v)+1))}else f=e((s[l+_*this.canvas.width]-i)/d);var x=4*(_*this.canvas.width+l),g=f[0],y=f[1],w=f[2];m[x+0]=g,m[x+1]=y,m[x+2]=w,m[x+3]=255}this.ctx.putImageData(p,0,0)},t}();e.coordinateSystem=i},557:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RRTStar=e.Tree=void 0;var r=n(593),a=n(461),s=function(t,e,n){this.pos=t,this.parent=e,this.cost=n},i=function(){function t(){this.nodes=[]}return t.prototype.addNode=function(t,e,n){var r=(e?e.cost:0)+n,a=new s(t,e,r);return this.nodes.push(a),a},t.prototype.getRandomNode=function(){var t=Math.floor(Math.random()*this.nodes.length);return this.nodes[t]},t.prototype.getNodeCount=function(){return this.nodes.length},t}();e.Tree=i;var o=function(){function t(t,e){this.point_collides=function(){return!1},this.goal_reached=function(){return!1},this.minX=-10,this.maxX=10,this.minY=-10,this.maxY=10,this.goalnode=null,this.star=!0,this.searchradius=1,this.finished=!1,this.exploration_target=null,this.go_to_target=!1,this.tree=new i,this.tree.addNode(t,null,0),this.stepSize=e}return t.prototype.generateRRTStar=function(t){for(var e=0;e<t&&(null!=this.goalnode||!this.finished);e++){var n;n=this.generateRandomPoint();var r=this.findNearestNode(n),a=r[0],s=r[1],i=this.extend(a.pos,n,this.stepSize,s),o=i[0],c=i[1];if(o&&0==this.point_collides(o)){var u=void 0,_=!1;if(this.star){var l=this.findNearbyNodes(o);l.sort((function(t,e){return t[0].cost+t[1]-(e[0].cost+e[1])}));for(var h=0,d=l;h<d.length;h++){var p=d[h],m=p[0],f=p[1];if(!this.check_line_collides(m.pos,o)){u=this.tree.addNode(o,m,f),this.rewire(u,l),_=!0;break}}}else{if(this.check_line_collides(a.pos,o))continue;u=this.tree.addNode(o,a,c),_=!0}if(_&&this.goal_reached(o)){this.goalnode=this.tree.nodes[this.tree.nodes.length-1],this.finished=!0;break}}}return this.tree},t.prototype.generateRandomPoint=function(){var t=Math.random()*(this.maxX-this.minX)+this.minX,e=Math.random()*(this.maxY-this.minY)+this.minY;return new a.v2(t,e)},t.prototype.findNearestNode=function(t){for(var e=null,n=1/0,a=0,s=this.tree.nodes;a<s.length;a++){var i=s[a],o=(0,r.angledistance_2d)(i.pos,t);o<n&&(e=i,n=o)}return[e,n]},t.prototype.extend=function(t,e,n,s){if(s<=n)return[e,s];var i=(0,r.angle_diff)(t,e).normalize().scale(n),o=(0,r.mod)(t.x+i.x,2*Math.PI),c=(0,r.mod)(t.y+i.y,2*Math.PI);return[new a.v2(o,c),n]},t.prototype.re_check_solution_found=function(){if(null==this.goalnode)for(var t=0,e=this.tree.nodes.sort((function(t,e){return Math.random()-.5}));t<e.length;t++){var n=e[t];if(this.goal_reached(n.pos))return this.goalnode=n,this.finished=!0,!0}return!1},t.prototype.rewire=function(t,e){for(var n=0,r=e;n<r.length;n++){var a=r[n],s=a[0],i=a[1];if(null!=s.parent&&t.cost+i<s.cost){if(this.check_line_collides(s.pos,t.pos))continue;s.parent=t,s.cost=t.cost+i}}},t.prototype.findNearbyNodes=function(t){for(var e=[],n=0,a=this.tree.nodes;n<a.length;n++){var s=a[n],i=(0,r.angledistance_2d)(s.pos,t);i<=this.searchradius&&e.push([s,i])}return e},t.prototype.drawtree=function(t){for(var e=0;e<this.tree.nodes.length;e++){var n=this.tree.nodes[e];if(n.parent){var a=(0,r.angle_diff)(n.pos,n.parent.pos),s=(Math.random(),n.cost,n.cost,n.cost);s=[100,100,2e3*n.cost%255],t.line(n.pos,n.pos.add(a),s),t.line(n.parent.pos,n.parent.pos.sub(a),s)}}},t.prototype.get_shortest_path=function(){if(null==this.goalnode)return[];for(var t=[],e=this.goalnode;e;)t.push(e.pos),e=e.parent;return t.reverse()},t.prototype.check_line_collides=function(t,e){for(var n,a=(0,r.angle_diff)(t,e),s=Math.ceil(a.magnitude/this.stepSize),i=a.scale(1/s),o=t,c=0,u=[];c<s;)c++,0==((n=o=o.add(i)).x>=0&&n.y>=0&&n.x<=2*Math.PI&&n.y<=2*Math.PI)&&(o=e,i.scale(-1)),u.push(o.copy());for(var _=0,l=u.sort((function(t,e){return Math.random()-.5}));_<l.length;_++){var h=l[_];if(this.point_collides(h))return!0}return!1},t}();e.RRTStar=o},395:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function o(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,o)}c((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.perform_rrt_mode_loop=e.perform_rrt_mode_setdown=e.perform_rrt_mode_setup=void 0;var s=n(752),i=n(685),o=n(489),c=n(728),u=n(103),_=n(557),l=n(310),h=n(593),d=n(461),p=new _.RRTStar(d.v2.zero(),0),m=[];e.perform_rrt_mode_setup=function(){m.pop(),m.pop(),m.pop(),m.push(new c.CircleObstacle(new d.v2(5,5),1)),m.push(new c.CircleObstacle(new d.v2(-3.5,3.5),2)),m.push(new c.CircleObstacle(new d.v2(3,-7),2)),s.loss_heatmap_coord.heatmap((function(t,e){return y(t,e)?1:0}),u.matplotlib_cmap,l.toggle_level_set.checked,l.level_set_scale,l.level_set_offset),f=s.arm_tip_target,s.arm_coord.canvas.addEventListener("mousedown",v),function(){r(this,void 0,void 0,(function(){var t,e,n;return a(this,(function(r){switch(r.label){case 0:return 0!=p.finished?[3,2]:(o.input.LeftMouse&&s.loss_heatmap_coord.mouse_within_bounds&&(p.exploration_target=s.loss_heatmap_coord.last_mouse_pos),p.generateRRTStar(x),[4,(0,h.delay)(10)]);case 1:return r.sent(),[3,0];case 2:for(t=p.get_shortest_path(),e=0;e<t.length-1;e++)n=(0,h.angle_diff)(t[e],t[e+1]),s.loss_highres_coord.line(t[e],t[e].add(n),[255,0,0]),s.loss_highres_coord.line(t[e+1],t[e+1].sub(n),[255,0,0]);return[2]}}))}))}()},e.perform_rrt_mode_setdown=function(){s.arm_coord.canvas.removeEventListener("mousedown",v)};var f=s.arm_tip_target;function v(){f=s.arm_coord.last_mouse_pos;var t=new d.v2((0,h.mod)(i.current_arm.arm.segments[l.x_axis_index].angle,2*Math.PI),(0,h.mod)(i.current_arm.arm.segments[l.y_axis_index].angle,2*Math.PI));(p=new _.RRTStar(t,.2)).maxX=2*Math.PI,p.maxY=2*Math.PI,p.minX=0,p.minY=0,p.star=!0,p.searchradius=.5,p.point_collides=function(t){return y(t.x,t.y)},p.goal_reached=function(t){var e=(0,i.copy_arm)(i.current_arm.arm);return e.segments[l.x_axis_index].angle=t.x,e.segments[l.y_axis_index].angle=t.y,(0,i.get_arm_tip_pos)(e).sub(f).magnitude<.5},s.tip_trail.points=[],s.state_trail.points=[]}var x=1,g={segments:[],pos:d.v2.zero()};e.perform_rrt_mode_loop=function(){return r(this,void 0,void 0,(function(){var t,e,n,r;return a(this,(function(a){switch(a.label){case 0:for(0==p.finished&&(s.loss_highres_coord.clear(),p.drawtree(s.loss_highres_coord)),s.arm_coord.clear(),t=new d.v2((0,h.mod)(i.current_arm.arm.segments[l.x_axis_index].angle,2*Math.PI),(0,h.mod)(i.current_arm.arm.segments[l.y_axis_index].angle,2*Math.PI)),s.loss_highres_coord.circle(t,.2,[255,0,0]),(0,o.handle_input)(),e=0,n=m;e<n.length;e++)n[e].draw(s.arm_coord,[0,0,0]);return g=(0,i.copy_arm)(i.current_arm.arm),(r=y(i.current_arm.arm.segments[l.x_axis_index].angle,i.current_arm.arm.segments[l.y_axis_index].angle))&&(i.current_arm.arm=r?(0,i.copy_arm)(g):i.current_arm.arm),s.state_trail.update(t)&&s.tip_trail.update((0,i.get_arm_tip_pos)(i.current_arm.arm)),s.tip_trail.draw(s.arm_coord,[128,50,128]),s.state_trail.draw(s.loss_highres_coord,[255,0,0]),s.arm_coord.circle(s.arm_tip_target,.5,[128,50,128]),(0,i.drawArm)(s.arm_coord,i.current_arm.arm,r?[255,0,0]:[0,0,0]),[4,(0,h.delay)(10)];case 1:return a.sent(),[2]}}))}))};var y=function(t,e){var n=(0,i.copy_arm)(i.current_arm.arm);n.segments[l.x_axis_index].angle=t,n.segments[l.y_axis_index].angle=e;var r=(0,i.points_along_arm)(n,1);r.sort((function(t,e){return Math.random()-.5}));for(var a=!1,s=0,o=r;s<o.length;s++){var c=o[s];if(a)break;for(var u=0,_=m;u<_.length;u++)if(_[u].contains(c)){a=!0;break}}return a}},310:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.level_set_scale=e.y_axis_index=e.x_axis_index=e.level_set_offset=e.current_mode=e.toggle_level_set=void 0;var r=n(685),a=n(185),s=n(395),i=document.getElementById("rrt_mode"),o=document.getElementById("select_loss");e.toggle_level_set=document.getElementById("toggle_level_set");var c=document.getElementById("slider_level_set_scale"),u=document.getElementById("number_level_set_offset"),_=document.getElementById("x_axis_index"),l=document.getElementById("y_axis_index"),h=document.getElementById("arm_amount");e.toggle_level_set.addEventListener("change",(function(){var t=!e.toggle_level_set.checked;c.disabled=t,u.disabled=t})),c.disabled=!0,u.disabled=!0;function d(){switch(i.value){case"RRT":e.current_mode.rrt=!0,(0,s.perform_rrt_mode_setdown)(),(0,s.perform_rrt_mode_setup)();break;case"Gradient":e.current_mode.rrt=!1,(0,a.perform_gradient_mode_setup)();break;default:console.log("Error: unknown mode: "+i.value)}}e.current_mode=new function(){this.rrt="RRT"==i.value},e.level_set_offset=u.valueAsNumber,h.addEventListener("input",(function(){var t=h.valueAsNumber;(0,r.makeArm)(t),_.max=(t-2).toString(),l.max=(t-1).toString(),e.x_axis_index>t-2&&(e.x_axis_index=t-2,_.value=e.x_axis_index.toString()),e.y_axis_index>t-1&&(e.y_axis_index=t-1,l.value=e.y_axis_index.toString()),d()})),e.x_axis_index=_.valueAsNumber,_.addEventListener("input",(function(){e.x_axis_index=_.valueAsNumber,e.x_axis_index==e.y_axis_index&&(e.y_axis_index=e.x_axis_index+1,l.value=e.y_axis_index.toString()),d()})),e.y_axis_index=l.valueAsNumber,l.addEventListener("input",(function(){e.y_axis_index=l.valueAsNumber,e.x_axis_index==e.y_axis_index&&(e.x_axis_index=e.y_axis_index-1,_.value=e.x_axis_index.toString()),d()})),u.addEventListener("input",(function(){e.level_set_offset=u.valueAsNumber})),e.level_set_scale=c.valueAsNumber,c.addEventListener("input",(function(){e.level_set_scale=c.valueAsNumber})),i.addEventListener("change",(function(t){d()})),o.addEventListener("change",(function(t){switch(o.value){case"L2 squared":r.current_loss.loss="L2_squared";break;case"L2":r.current_loss.loss="L2";break;case"L1":r.current_loss.loss="L1";break;case"L1 squared":r.current_loss.loss="L1_squared";break;case"Match Y":r.current_loss.loss="Match_Y";break;default:console.log("Error: unknown loss type: "+i.value)}r.current_loss.loss_func=r.Losses.get_loss(r.current_loss.loss),r.current_loss.loss_gradient_func=r.Losses.get_loss_gradient(r.current_loss.loss)}))},527:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Trail=void 0;var r=n(461),a=function(){function t(t,e,n){this.points=[],this.max_points=t,this.min_dist=e,this.max_dist=n}return t.prototype.update=function(t){if(this.points.length>this.max_points&&this.points.shift(),0==this.points.length)return this.points.push([t,!0]),!0;var e=r.v2.distance(this.points[this.points.length-1][0],t);return e>this.min_dist&&(this.points.push([t,e<this.max_dist]),!0)},t.prototype.draw=function(t,e){for(var n=0;n<this.points.length-1;n++)if(this.points[n+1][1]){var r=this.points[n][0],a=this.points[n+1][0];t.line(r,a,e)}},t}();e.Trail=a},593:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function o(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,o)}c((r=r.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,r,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.angle_diff=e.fastest_way_angle=e.angledistance_2d=e.delay=e.mod=void 0;var s=n(461);function i(t,e){return Math.abs(e-t)<Math.PI?e-t:t<e?e-(t+2*Math.PI):e-(t-2*Math.PI)}e.mod=function(t,e){return(t%e+e)%e},e.delay=function(t){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){return setTimeout(e,t)}))];case 1:return e.sent(),[2]}}))}))},e.angledistance_2d=function(t,e){var n=Math.abs(i(t.x,e.x)),r=Math.abs(i(t.y,e.y));return Math.sqrt(n*n+r*r)},e.fastest_way_angle=i,e.angle_diff=function(t,e){return new s.v2(i(t.x,e.x),i(t.y,e.y))}},461:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.v2=void 0;var n=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.scale=function(e){return new t(this.x*e,this.y*e)},Object.defineProperty(t.prototype,"magnitude",{get:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},enumerable:!1,configurable:!0}),t.prototype.copy=function(){return new t(this.x,this.y)},t.prototype.normalize=function(){var e=this.magnitude;return new t(this.x/e,this.y/e)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.distance=function(e){return t.distance(this,e)},t.prototype.angle=function(t){var e=this.dot(t)/(this.magnitude*t.magnitude);return Math.acos(e)},t.fromPolar=function(e,n){return new t(n*Math.cos(e),n*Math.sin(e))},t.zero=function(){return new t},t.distance=function(t,e){return t.sub(e).magnitude},t}();e.v2=n}},e={};!function n(r){var a=e[r];if(void 0!==a)return a.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,n),s.exports}(752)})();
//# sourceMappingURL=bundle.js.map